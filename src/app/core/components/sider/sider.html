<div class="flex flex-col h-full text-gray-200">
  <!-- Top section: Logo + New Chat -->
  <div
    class="p-2 flex items-center justify-between"
    [class.flex-col]="sidebarCollapsed()"
  >
    @if (!sidebarCollapsed()) {
      <button
        nz-button
        nzType="text"
        class="text-gray-200! hover:bg-dark-input!"
        (click)="onToggleSidebar()"
      >
        <span nz-icon nzType="menu-fold" nzTheme="outline"></span>
      </button>
    }
    @if (sidebarCollapsed()) {
      <button
        nz-button
        nzType="text"
        class="text-gray-200! hover:bg-dark-input!"
        (click)="onToggleSidebar()"
      >
        <span nz-icon nzType="menu-unfold" nzTheme="outline"></span>
      </button>
    }
    <button
      nz-button
      nzType="text"
      nz-tooltip
      nzTooltipTitle="New chat"
      class="text-gray-200! hover:bg-dark-input!"
      (click)="onNewChat()"
    >
      <span nz-icon nzType="edit" nzTheme="outline"></span>
    </button>
  </div>

  <!-- Search -->
  @if (!sidebarCollapsed()) {
    <div class="px-2 pb-2">
      <nz-input-wrapper class="bg-dark-input! rounded-lg!">
        <nz-icon nzInputPrefix nzType="search" class="app-text" />
        <input
          type="text"
          nz-input
          placeholder="Buscar chats"
          [(ngModel)]="searchQuery"
          class="bg-transparent! text-gray-200! placeholder-gray-500!"
        />
      </nz-input-wrapper>
    </div>
  }

  <!-- Chat history -->
  <div class="flex-1 overflow-y-auto px-1">
    @if (chatsResource.isLoading()) {
      <!-- Loading skeleton -->
      @for (i of [1, 2, 3, 4, 5]; track i) {
        <div class="flex items-center px-2 py-2">
          @if (!sidebarCollapsed()) {
            <nz-skeleton
              [nzActive]="true"
              [nzParagraph]="{ rows: 1, width: '100%' }"
              [nzTitle]="false"
            ></nz-skeleton>
          } @else {
            <nz-skeleton-element
              nzType="avatar"
              [nzActive]="true"
              nzSize="small"
              nzShape="circle"
            ></nz-skeleton-element>
          }
        </div>
      }
    } @else {
      @for (chat of filteredChats(); track chat.id) {
        <div
          class="group relative flex items-center px-2 py-2 rounded-lg cursor-pointer hover:bg-gray-400 dark:hover:bg-dark-input app-text trans-c-200"
          [routerLink]="['/chat', chat.id]"
          [class.hidden]="sidebarCollapsed()"
          [class.bg-dark-input]="selectedChatId() === chat.id"
          (click)="onSelectChat(chat.id)"
        >
          @if (!sidebarCollapsed()) {
            @if (chat.title) {
              <span class="truncate text-sm flex-1">{{ chat.title }}</span>
            } @else {
              <nz-skeleton
                class="flex-1"
                [nzActive]="true"
                [nzParagraph]="{ rows: 1, width: '80%' }"
                [nzTitle]="false"
              ></nz-skeleton>
            }
            <div class="opacity-0 group-hover:opacity-100 transition-opacity">
              <button
                nz-button
                nzType="text"
                nzSize="small"
                nz-dropdown
                [nzDropdownMenu]="chatMenu"
                nzTrigger="click"
                class="text-gray-400! hover:text-gray-200!"
                (click)="$event.stopPropagation()"
              >
                <span nz-icon nzType="more" nzTheme="outline"></span>
              </button>
              <nz-dropdown-menu #chatMenu>
                <ul nz-menu class="bg-dark-input!">
                  <li nz-menu-item class="text-gray-200! hover:bg-dark-border!">
                    <span nz-icon nzType="share-alt" class="mr-2"></span>
                    Share
                  </li>
                  <li nz-menu-item class="text-gray-200! hover:bg-dark-border!">
                    <span nz-icon nzType="edit" class="mr-2"></span>
                    Rename
                  </li>
                  <li nz-menu-item class="text-gray-200! hover:bg-dark-border!">
                    <span nz-icon nzType="inbox" class="mr-2"></span>
                    Archive
                  </li>
                  <li nz-menu-item class="text-red-400! hover:bg-dark-border!" nzDanger>
                    <span nz-icon nzType="delete" class="mr-2"></span>
                    Delete
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          } @else {
            <span nz-icon nzType="message" nzTheme="outline" class="text-gray-400"></span>
          }
        </div>
      }
    }
  </div>

  <!-- User section -->
  <div class="p-2 border-t border-dark-input">
    <!-- Navigation items -->
    <div class="mb-2">
      <div
        class="flex items-center gap-2 px-2 py-2 rounded-lg cursor-pointer hover:bg-dark-input text-gray-300"
        (click)="onNavigateToPrompts()"
      >
        <span nz-icon nzType="file-text" nzTheme="outline"></span>
        @if (!sidebarCollapsed()) {
          <span class="text-sm">Prompts</span>
        }
      </div>
    </div>
    <div class="flex items-center gap-2 p-2 rounded-lg cursor-pointer hover:bg-dark-input">
      <nz-avatar nzSize="small" nzText="U" class="bg-teal-600! text-white!"></nz-avatar>
      @if (!sidebarCollapsed()) {
        <span class="text-sm truncate flex-1">{{ userEmail() }}</span>
      }
    </div>
  </div>
</div>
