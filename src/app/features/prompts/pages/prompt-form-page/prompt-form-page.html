<div class="flex flex-col h-full">
  <!-- Header -->
  <div class="flex items-center justify-end p-4 border-b border-dark-input">
    <button
      nz-button
      nzType="text"
      nzSize="small"
      class="text-gray-400! hover:text-gray-200!"
      (click)="onCancel()"
    >
      <span nz-icon nzType="close"></span>
    </button>
  </div>

  <!-- Form -->
  <form [formGroup]="form" (ngSubmit)="onSave()" class="flex-1 overflow-y-auto p-4">
    <!-- Name field -->
    <nz-form-item>
      <nz-form-label>Name</nz-form-label>
      <nz-form-control nzErrorTip="Name is required">
        <input
          nz-input
          formControlName="name"
          placeholder="Enter prompt name"
          class="bg-dark-input! border-dark-border! text-gray-200! placeholder:text-gray-500!"
        />
      </nz-form-control>
    </nz-form-item>

    <!-- Content field -->
    <nz-form-item>
      <nz-form-label>Content</nz-form-label>
      <nz-form-control nzErrorTip="Content is required">
        <textarea
          nz-input
          formControlName="content"
          placeholder="Enter prompt content"
          [nzAutosize]="{ minRows: 3, maxRows: 6 }"
          class="bg-dark-input! border-dark-border! text-gray-200! placeholder:text-gray-500!"
        ></textarea>
      </nz-form-control>
    </nz-form-item>

    <!-- Messages section -->
    <div class="mt-4">
      <div class="flex items-center justify-between mb-3">
        <span class="text-sm font-medium text-gray-300">Messages</span>
        <button
          nz-button
          nzType="dashed"
          nzSize="small"
          type="button"
          class="text-gray-400! border-gray-500! hover:text-gray-200! hover:border-gray-300!"
          (click)="onAddMessage()"
        >
          <span nz-icon nzType="plus"></span>
          Add Message
        </button>
      </div>

      @if (messages.length === 0) {
        <div
          class="text-center text-gray-500 py-4 border border-dashed border-dark-border rounded-lg"
        >
          No messages yet. Click "Add Message" to create one.
        </div>
      } @else {
        <div formArrayName="messages" class="space-y-3">
          @for (message of messages.controls; track $index; let i = $index) {
            <div
              [formGroupName]="i"
              class="p-3 bg-dark-elevated rounded-lg border border-dark-border"
            >
              <div class="flex items-center justify-between mb-2">
                <nz-select
                  formControlName="role"
                  class="w-32! [&_.ant-select-selector]:bg-dark-input! [&_.ant-select-selector]:border-dark-border-light! [&_.ant-select-selection-item]:text-gray-200!"
                  nzSize="small"
                >
                  <nz-option nzValue="user" nzLabel="User"></nz-option>
                  <nz-option nzValue="assistant" nzLabel="Assistant"></nz-option>
                </nz-select>
                <button
                  nz-button
                  nzType="text"
                  nzSize="small"
                  type="button"
                  class="text-red-400! hover:text-red-300!"
                  nz-popconfirm
                  nzPopconfirmTitle="Are you sure you want to delete this message? This action cannot be undone."
                  nzPopconfirmDescription="This action cannot be undone."
                  nzOkText="Delete"
                  nzCancelText="Cancel"
                  (nzOnConfirm)="onRemoveMessage(i)"
                >
                  <span nz-icon nzType="delete"></span>
                </button>
              </div>
              <textarea
                nz-input
                formControlName="content"
                placeholder="Enter message content"
                [nzAutosize]="{ minRows: 2, maxRows: 4 }"
                class="bg-dark-muted! border-dark-border-light! text-gray-200! placeholder:text-gray-500!"
              ></textarea>
            </div>
          }
        </div>
      }
    </div>
  </form>

  <!-- Footer -->
  <div class="flex items-center justify-end gap-2 p-4 border-t border-dark-input">
    <button
      class="bg-transborder-dark-border! hover:border-gray-400! app-text"
      nz-button
      nzType="default"
      type="button"
      (click)="onCancel()"
    >
      Cancel
    </button>
    <button class="text-white!" nz-button nzType="primary" (click)="onSave()">
      {{ isEditMode() ? 'Update' : 'Create' }}
    </button>
  </div>
</div>
